var Mongodb=require("mongodb");Mongodb.MongoClient.connect("mongodb://127.0.0.1:27017/MEANProject",(n,t)=>{var r=require("express"),u=r(),o=require("express-handlebars"),f=require("body-parser"),i=require("md5"),e;console.log("\nConnected to Database:"+t.databaseName+" successfully.");require("http").createServer(u).listen(3685);console.log("Server listen @port 3685\n");e=o.create({extname:".hbs",defaultLayout:"main",layoutsDir:"views/layouts/",partialsDir:"views/partials/"});u.engine(".hbs",e.engine).set("view engine",".hbs").use(r.static("./public")).use(f.json()).use(f.urlencoded({extended:!0})).get(new RegExp("^\\/((?:index|default)(\\.(?:htm|html))?)?(\\?.*)?$"),(n,t)=>{t.render("home")}).get(new RegExp("home(\\.(?:htm|html))?(\\?.*)?$"),(n,t)=>{n.xhr||n.headers.accept.indexOf("json")>-1?t.render("home",{layout:!1,login:!0}):t.redirect("/#/home")}).get(new RegExp("profile(\\.(?:htm|html))?(\\?.*)?$"),(n,t)=>{n.xhr||n.headers.accept.indexOf("json")>-1?t.render("profile",{layout:!1,CPanel:!0}):t.redirect("/admincp/#/profile")}).get(new RegExp("/admincp.*$"),(n,t)=>{n.xhr||n.headers.accept.indexOf("json")>-1?t.render("cp-home",{layout:!1,CPanel:!0}):t.render("cp-home",{layout:"cpanel",CPanel:!0})}).get(new RegExp("about(\\.(?:htm|html))?(\\?.*)?$"),(n,t)=>{n.xhr||n.headers.accept.indexOf("json")>-1?t.render("about",{layout:!1}):t.redirect("/#/about")}).get(new RegExp("contact(\\.(?:htm|html))?(\\?.*)?$"),(n,t)=>{n.xhr||n.headers.accept.indexOf("json")>-1?t.render("contact",{layout:!1}):t.redirect("/#/contact")}).get(new RegExp("login(\\.(?:htm|html))?(\\?.*)?$"),(n,t)=>{n.xhr||n.headers.accept.indexOf("json")>-1?t.render("login",{layout:!1,login:!0}):t.redirect("/#/login")}).get(new RegExp("register(\\.(?:htm|html))?(\\?.*)?$"),(n,t)=>{n.xhr||n.headers.accept.indexOf("json")>-1?t.render("login",{layout:!1,register:!0}):t.redirect("/#/register")}).post("/API/Login",(n,r)=>{t.collection("Users").find({username:n.body.username,password:i(n.body.password)}).toArray((n,t)=>{ret_val={correct:!1,user:t[0]},t.length>0&&(delete ret_val.user.password,ret_val.correct=!0),r.json(ret_val)})}).post("/API/User",(n,r)=>{t.collection("Users").insert({name:n.body.name,username:n.body.username,email:n.body.email,password:i(n.body.password)}),t.collection("Users").find({username:n.body.username,password:i(n.body.password)}).toArray((n,t)=>{ret_val={correct:!1,user:t[0]},t.length>0&&(delete ret_val.user.password,ret_val.correct=!0),r.json(ret_val)})}).put("/API/User",(n,r)=>{t.collection("Users").updateOne({_id:new Mongodb.ObjectId(n.body._id)},{name:n.body.name,username:n.body.username,email:n.body.email,password:i(n.body.password)},{upsert:!0},(n,t)=>{if(n)return r.send(n);r.json(t)})}).get("/API/Employees",(n,i)=>{t.collection("Employees").find().toArray((n,t)=>{if(n)return i.send(n);i.json(t)})}).post("/API/Employee",(n,i)=>{t.collection("Employees").insertOne({name:n.body.name,dept:n.body.dept,joinDate:n.body.joinDate,salary:n.body.salary,eval:n.body.eval},(n,t)=>{if(n)return i.send(n);i.json(t)})}).put("/API/Employee",(n,i)=>{t.collection("Employees").updateOne({_id:new Mongodb.ObjectId(n.body._id)},{name:n.body.name,dept:n.body.dept,joinDate:n.body.joinDate,salary:n.body.salary,eval:n.body.eval},{upsert:!0},(n,t)=>{if(n)return i.send(n);i.json(t)})}).delete("/API/Employee",(n,i)=>{t.collection("Employees").remove({_id:new Mongodb.ObjectId(n.body._id)},(n,t)=>{if(n)return i.send(n);i.json(t)})}).post("/API/Message",(n,i)=>{t.collection("Messages").insertOne({name:n.body.name,email:n.body.email,message:n.body.msg},(n,t)=>{if(n)return i.send(n);i.json(t)})})});